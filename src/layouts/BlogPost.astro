---
/**
 * Blog Post Layout
 * Layout for individual blog posts with markdown content
 *
 * @typedef {Object} Frontmatter
 * @property {string} title
 * @property {string} description
 * @property {string} pubDate
 * @property {string} [thumbnail]
 * @property {string[]} [tags]
 * @property {string} [author]
 *
 * @typedef {Object} Props
 * @property {Frontmatter} frontmatter
 */

import Base from './Base.astro';
import { formatDate, estimateReadingTime } from '../utils/helpers.js';

const { frontmatter } = Astro.props;
const {
  title,
  description,
  pubDate,
  thumbnail = '/og-image.jpg',
  tags = [],
  author = 'Kohaku Lab',
} = frontmatter;

// Get the raw markdown content for reading time estimation
const rawContent = await Astro.slots.render('default');
const readingTime = estimateReadingTime(rawContent.replace(/<[^>]*>/g, ''));
---

<Base title={`${title} | Kohaku Lab Blog`} description={description} image={thumbnail}>
  <!-- Navigation Slot -->
  <slot name="nav" slot="nav" />

  <!-- Blog Post Content -->
  <article class="container-narrow py-8">
    <!-- Back Button -->
    <div class="mb-6">
      <a href="/blog" class="link inline-flex items-center gap-2">
        <span class="i-carbon-arrow-left text-xl"></span>
        Back to Blog
      </a>
    </div>

    <!-- Post Header -->
    <header class="mb-8">
      <h1 class="text-4xl sm:text-5xl font-bold text-slate-100 mb-4 leading-tight">
        {title}
      </h1>

      <!-- Post Meta -->
      <div class="flex flex-wrap items-center gap-4 text-slate-400 text-sm">
        <div class="flex items-center gap-2">
          <span class="i-carbon-calendar text-lg"></span>
          <time datetime={pubDate}>{formatDate(pubDate)}</time>
        </div>
        <div class="flex items-center gap-2">
          <span class="i-carbon-time text-lg"></span>
          <span>{readingTime} min read</span>
        </div>
        {
          author && (
            <div class="flex items-center gap-2">
              <span class="i-carbon-user text-lg" />
              <span>{author}</span>
            </div>
          )
        }
      </div>

      <!-- Tags -->
      {
        tags.length > 0 && (
          <div class="flex flex-wrap gap-2 mt-4">
            {tags.map(tag => (
              <a
                href={`/blog?tag=${encodeURIComponent(tag)}`}
                class="tag bg-slate-700 text-slate-200 hover:bg-slate-600 transition-colors"
              >
                #{tag}
              </a>
            ))}
          </div>
        )
      }
    </header>

    <!-- Thumbnail Image -->
    {
      thumbnail && thumbnail !== '/og-image.jpg' && (
        <div class="mb-8 rounded-lg overflow-hidden">
          <img src={thumbnail} alt={title} class="w-full h-auto object-cover" loading="eager" />
        </div>
      )
    }

    <!-- Post Content with Prose Styling -->
    <div class="prose prose-invert prose-slate max-w-none">
      <slot />
    </div>

    <!-- Post Footer -->
    <footer class="mt-12 pt-8 border-t border-slate-700">
      <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
        <div>
          <p class="text-slate-400 text-sm mb-2">Share this post</p>
          <div class="flex gap-3">
            <a
              href={`https://twitter.com/intent/tweet?text=${encodeURIComponent(title)}&url=${encodeURIComponent(Astro.url.href)}`}
              target="_blank"
              rel="noopener noreferrer"
              class="text-slate-400 hover:text-blue-400 transition-colors"
              aria-label="Share on Twitter"
            >
              <span class="i-carbon-logo-twitter text-2xl"></span>
            </a>
            <a
              href={`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(Astro.url.href)}`}
              target="_blank"
              rel="noopener noreferrer"
              class="text-slate-400 hover:text-blue-400 transition-colors"
              aria-label="Share on Facebook"
            >
              <span class="i-carbon-logo-facebook text-2xl"></span>
            </a>
            <a
              href={`https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(Astro.url.href)}`}
              target="_blank"
              rel="noopener noreferrer"
              class="text-slate-400 hover:text-blue-400 transition-colors"
              aria-label="Share on LinkedIn"
            >
              <span class="i-carbon-logo-linkedin text-2xl"></span>
            </a>
          </div>
        </div>
        <a href="/blog" class="btn-secondary"> View All Posts </a>
      </div>
    </footer>
  </article>

  <!-- Footer Slot -->
  <slot name="footer" slot="footer" />
</Base>

<style is:global>
  /* Prose styling for markdown content */
  .prose {
    color: #cbd5e1;
    line-height: 1.75;
  }

  .prose h1 {
    font-size: 2.25rem;
    font-weight: 800;
    color: #f1f5f9;
    margin-top: 3rem;
    margin-bottom: 1.5rem;
    line-height: 1.2;
  }

  .prose h2 {
    font-size: 1.875rem;
    font-weight: 700;
    color: #f1f5f9;
    margin-top: 3rem;
    margin-bottom: 1rem;
    line-height: 1.3;
  }

  .prose h3 {
    font-size: 1.5rem;
    font-weight: 600;
    color: #f1f5f9;
    margin-top: 2rem;
    margin-bottom: 0.75rem;
    line-height: 1.4;
  }

  .prose h4 {
    font-size: 1.25rem;
    font-weight: 600;
    color: #f1f5f9;
    margin-top: 1.5rem;
    margin-bottom: 0.5rem;
    line-height: 1.4;
  }

  .prose h5 {
    font-size: 1.125rem;
    font-weight: 600;
    color: #f1f5f9;
    margin-top: 1.5rem;
    margin-bottom: 0.5rem;
  }

  .prose p {
    margin-bottom: 1rem;
    line-height: 1.75;
  }

  .prose a {
    color: #60a5fa;
    text-decoration: underline;
    text-underline-offset: 2px;
    transition: color 0.3s;
  }

  .prose a:hover {
    color: #93c5fd;
  }

  .prose ul,
  .prose ol {
    margin-bottom: 1rem;
    padding-left: 1.5rem;
  }

  .prose li {
    margin-bottom: 0.5rem;
  }

  .prose ul li {
    list-style-type: disc;
  }

  .prose ol li {
    list-style-type: decimal;
  }

  .prose code {
    background-color: #1e293b;
    color: #f0abfc;
    padding: 0.125rem 0.375rem;
    border-radius: 0.25rem;
    font-size: 0.875rem;
    font-family: 'Courier New', monospace;
  }

  .prose pre {
    background-color: #1e293b;
    border: 1px solid #334155;
    border-radius: 0.5rem;
    padding: 1rem;
    margin-bottom: 1rem;
    overflow-x: auto;
  }

  .prose pre code {
    background-color: transparent;
    color: #cbd5e1;
    padding: 0;
    font-size: 0.875rem;
  }

  .prose blockquote {
    border-left: 4px solid #3b82f6;
    padding-left: 1rem;
    font-style: italic;
    color: #94a3b8;
    margin: 1rem 0;
  }

  .prose img {
    border-radius: 0.5rem;
    margin: 1.5rem 0;
    max-width: 100%;
  }

  .prose table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 1rem;
  }

  .prose th {
    background-color: #1e293b;
    color: #f1f5f9;
    font-weight: 600;
    padding: 0.75rem;
    text-align: left;
    border: 1px solid #334155;
  }

  .prose td {
    padding: 0.75rem;
    border: 1px solid #334155;
    color: #cbd5e1;
  }

  .prose hr {
    border-color: #334155;
    border-top-width: 1px;
    margin: 2rem 0;
  }

  .prose strong {
    color: #f1f5f9;
    font-weight: 600;
  }

  .prose em {
    font-style: italic;
  }

  /* First paragraph after heading - slight increase */
  .prose h1 + p,
  .prose h2 + p,
  .prose h3 + p {
    margin-top: 0.5rem;
  }
</style>
